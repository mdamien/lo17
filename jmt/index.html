<!DOCTYPE html>
<html>
<head>
 <meta charset="utf-8">
 <title>Grammar</title>
 <link rel="stylesheet" href="http://bootswatch.com/lumen/bootstrap.min.css">
 <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Googletin</h1>
    <h4></h4>
    <hr/>
    <form action="" method="get" class="form-horizontal">
    <div class="row">
    <div class="col-md-9">
	    <div class="form-group">
	        <input type="text" class="form-control" name="query" id="query" value=""/>
	    </div>
    </div>
    <div class="col-md-1">
    	<input type="submit" class="btn btn-info btn-md btn-block" id="correct" value="Corriger"/>
    </div>
    <div class="col-md-2">
    	<input type="submit" class="btn btn-primary btn-lg btn-block" value="Rechercher"/>
    </div>
    </div>
    <div class="row" id="suggestions">
    	
    </div>
    </form>
    <hr>
    <pre id="output"></pre>
    <script type="text/javascript">
  $("form").submit(e => {
      e.preventDefault();
      e.returnValue = false;
      var q = $('#query').val()
      $.get('/jmt/servlet/LanceRequete?suggest=true&requete='+q,
      		data => {
      			$('#output').html(JSON.stringify(data,null,2));
      		})
  });
  
  $('#correct').click(e => {
	  e.preventDefault();
	  e.returnValue = false;
      var q = $('#query').val()
      $.get('/jmt/servlet/LanceRequete?suggest=only&requete='+q,
      			data => {
      				var test = [
      				    {
      				    	word:'bananap',
      				    	alternatives:['banane','banana','banbana'],
      				    },
      				    {
      				    	word:'mangent',
      				    	alternatives:[],
      				    },
      				    {
      				    	word:'youps',
      				    	alternatives:['youpi','youpa','youp'],
      				    },
      				    {
      				    	word:'jean',
      				    	alternatives:['michel'],
      				    },
      				    {
      				    	word:'michel',
      				    	alternatives:['jean','youpa','youp'],
      				    },
      				]
      				results = data.suggestions;
      				SUGGESTIONS = results
      				var html = "<pre>"+JSON.stringify(results)+"</pre>";
      				$('#suggestions').html(html);
      				results.map( (r,i) => {
      					r.curr = r.word;
      					if(r.alternatives.length > 0){
	      					html += '<select>';
	      					var fonction = "SUGGESTIONS["+i+"].curr = '"+r.word+"';update()";
      						html += "<option onclick=\""+fonction+"\">"+r.word+"</option>";
	      					r.alternatives.map(alt => {
	      						fonction = "SUGGESTIONS["+i+"].curr = '"+alt+"';update()";
	      						console.log(fonction)
	      						html += "<option onclick=\""+fonction+"\">"+alt+"</option>";
	      					})
	      					html += '</select>';
      					}else{
      						html += r.word;
      					}
      					html += "&nbsp"
      				})
      				
      				$('#suggestions').html(html);
      			})
  })
  
  function update(){
	  $('#query').val(SUGGESTIONS.map(x => x.curr).join(' '))
  }
    </script>
  </div>
</body>
</html>